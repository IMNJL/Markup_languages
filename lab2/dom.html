<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Parser - –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .in-stock { color: green; font-weight: bold; }
        .out-of-stock { color: red; font-weight: bold; }
        .stats { background: #f5f5f5; padding: 10px; margin: 20px 0; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üõí –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ (DOM –æ–±—Ä–∞–±–æ—Ç–∫–∞)</h1>

    <div class="stats">
        <button onclick="loadXML()">–ó–∞–≥—Ä—É–∑–∏—Ç—å XML</button>
        <button onclick="showStats()">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
        <button onclick="filterByCategory('–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞')">–¢–æ–ª—å–∫–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
        <button onclick="showAll()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</button>
    </div>

    <div id="output"></div>
    <div id="stats"></div>

    <script>
        let xmlDoc = null;
        let currentProducts = [];

        function loadXML() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "catalog.xml", true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        xmlDoc = xhr.responseXML;
                        displayProducts(xmlDoc.getElementsByTagName("product"));
                        document.getElementById("stats").innerHTML =
                            "<p class='success'>‚úÖ XML —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω</p>";
                    } else {
                        document.getElementById("output").innerHTML =
                            "<p class='error'>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ XML —Ñ–∞–π–ª–∞</p>";
                    }
                }
            };
            xhr.send();
        }

        function displayProducts(products) {
            currentProducts = Array.from(products);
            let html = "";

            currentProducts.forEach(product => {
                const id = product.getAttribute("id");
                const name = product.getElementsByTagName("name")[0].textContent;
                const price = product.getElementsByTagName("price")[0].textContent;
                const category = product.getElementsByTagName("category")[0].textContent;
                const inStock = product.getElementsByTagName("in_stock")[0].textContent;

                html += `
                <div class="product">
                    <h3>${name}</h3>
                    <p><strong>ID:</strong> ${id}</p>
                    <p><strong>–¶–µ–Ω–∞:</strong> ${parseInt(price).toLocaleString()} —Ä—É–±.</p>
                    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${category}</p>
                    <p><strong>–ù–∞–ª–∏—á–∏–µ:</strong>
                        <span class="${inStock === 'true' ? 'in-stock' : 'out-of-stock'}">
                            ${inStock === 'true' ? '‚úì –í –Ω–∞–ª–∏—á–∏–∏' : '‚úó –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                        </span>
                    </p>
                </div>`;
            });

            document.getElementById("output").innerHTML = html;
        }

        function showStats() {
            if (!xmlDoc) {
                alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ XML!");
                return;
            }

            const products = xmlDoc.getElementsByTagName("product");
            const totalProducts = products.length;
            const electronics = Array.from(products).filter(p =>
                p.getElementsByTagName("category")[0].textContent === '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞').length;
            const books = Array.from(products).filter(p =>
                p.getElementsByTagName("category")[0].textContent === '–ö–Ω–∏–≥–∏').length;
            const inStock = Array.from(products).filter(p =>
                p.getElementsByTagName("in_stock")[0].textContent === 'true').length;

            document.getElementById("stats").innerHTML = `
                <div class="stats">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞:</h3>
                    <p>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${totalProducts}</p>
                    <p>–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞: ${electronics}</p>
                    <p>–ö–Ω–∏–≥–∏: ${books}</p>
                    <p>–í –Ω–∞–ª–∏—á–∏–∏: ${inStock}</p>
                    <p>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏: ${totalProducts - inStock}</p>
                </div>`;
        }

        function filterByCategory(category) {
            if (!xmlDoc) {
                alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ XML!");
                return;
            }

            const allProducts = xmlDoc.getElementsByTagName("product");
            const filtered = Array.from(allProducts).filter(product =>
                product.getElementsByTagName("category")[0].textContent === category);

            displayProducts(filtered);
        }

        function showAll() {
            if (xmlDoc) {
                displayProducts(xmlDoc.getElementsByTagName("product"));
            }
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = loadXML;
    </script>
</body>
</html>